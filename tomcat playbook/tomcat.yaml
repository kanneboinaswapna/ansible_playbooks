---
 - name: tomcat 10 install playbook
   hosts: all
   become: yes
   vars:
     username: tomcat
     groupname: tomcat
     homedir: /opt/tomcat
     shell: /bin/false
     MAJOR_VERSION: 10
     VERSION: 10.1.14
     java_version: "11"
   tasks:
     - name: install jdk
       ansible.builtin.apt:
        name: "openjdk-{{ java_version }}-jdk"
        update_cache: yes
        state: present
     - name: Ensure group "tomcat" exists
       ansible.builtin.group:
         name: tomcat 
         state: present
     - name: create tomcat user
       ansible.builtin.user:
         name: "{{ username }}"
         shell: "{{ shell }}"
         group: "{{ groupname }}"
     - name: download tomcat to /tmp 
       ansible.builtin.get_url:
         url: "https://dlcdn.apache.org/tomcat/tomcat-{{MAJOR_VERSION}}/v{{VERSION}}/bin/apache-tomcat-{{VERSION}}.tar.gz"
         dest: "/tmp/apache-tomcat-${VERSION}.tar.gz"
     - name: extract tar file
       ansible.builtin.unarchive:
        src: "/tmp/apache-tomcat-${VERSION}.tar.gz"
        creates: "{{ homedir }}/apache-tomcat-{{VERSION}}.tar.gz"
        dest: "{{ homedir }}"
        owner: "{{ username }}"
        group: "{{ groupname }}"
     - name: create a symlink
       ansible.builtin.file:
         src: /opt/tomcat/apache-tomcat-${VERSION}
         dest: /opt/tomcat/latest
         owner: "{{ username }}" 
         group: "{{ group }}"     
     - name: change ownership to /opt/tomcat
       ansible.builtin.file:
         path: /opt/tomcat
         owner: "{{ username }}"
         group: "{{ group }}"
     - name: give excute permissions
       ansible.builtin.file:
         path: /opt/tomcat
         recurse: yes
         mode: '755'
         state: directory
         owner: "{{ username }}"
         group: "{{ group }}"
     - name: create a service file
       ansible.builtin.service:
         name: tomcat
         state: enabled 
     - name: start the service file
       ansible.builtin.service:
         name: tomcat
         state: started
     - name: restart the service file
       ansible.builtin.service:
         name: tomcat
         state: restarted
     




        

